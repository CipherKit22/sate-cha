{"ast":null,"code":"import React,{createContext,useContext,useEffect,useState}from'react';import{authService}from'../services/auth';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(undefined);export const useAuth=()=>{const context=useContext(AuthContext);if(context===undefined){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{// Check for existing session\nconst initializeAuth=async()=>{try{const currentUser=await authService.getCurrentUser();setUser(currentUser);}catch(error){console.error('Auth initialization error:',error);}finally{setLoading(false);}};initializeAuth();// Listen for auth changes\nconst{data:{subscription}}=authService.onAuthStateChange(user=>{setUser(user);setLoading(false);});return()=>{subscription===null||subscription===void 0?void 0:subscription.unsubscribe();};},[]);const signIn=async(email,password)=>{setLoading(true);try{const result=await authService.signIn({email,password});if(result.user){setUser(result.user);return{};}return{error:result.error||'Sign in failed'};}catch(error){return{error:'An unexpected error occurred'};}finally{setLoading(false);}};const signUp=async data=>{setLoading(true);try{const result=await authService.signUp(data);if(result.user){setUser(result.user);return{};}return{error:result.error||'Sign up failed'};}catch(error){return{error:'An unexpected error occurred'};}finally{setLoading(false);}};const signOut=async()=>{setLoading(true);try{await authService.signOut();setUser(null);}catch(error){console.error('Sign out error:',error);}finally{setLoading(false);}};const updateProfile=async updates=>{if(!user)return{error:'No user logged in'};try{const result=await authService.updateProfile(user.id,updates);if(!result.error){// Refresh user data\nconst updatedUser=await authService.getCurrentUser();setUser(updatedUser);}return result;}catch(error){return{error:'Failed to update profile'};}};const value={user,loading,signIn,signUp,signOut,updateProfile};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","authService","jsx","_jsx","AuthContext","undefined","useAuth","context","Error","AuthProvider","_ref","children","user","setUser","loading","setLoading","initializeAuth","currentUser","getCurrentUser","error","console","data","subscription","onAuthStateChange","unsubscribe","signIn","email","password","result","signUp","signOut","updateProfile","updates","id","updatedUser","value","Provider"],"sources":["C:/Users/Acer/Downloads/test1/frontend/src/contexts/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState, ReactNode } from 'react';\nimport { authService, User } from '../services/auth';\n\ninterface AuthContextType {\n  user: User | null;\n  loading: boolean;\n  signIn: (email: string, password: string) => Promise<{ error?: string }>;\n  signUp: (data: {\n    email: string;\n    password: string;\n    username: string;\n    fullName: string;\n    languagePreference: 'en' | 'my';\n  }) => Promise<{ error?: string }>;\n  signOut: () => Promise<void>;\n  updateProfile: (updates: any) => Promise<{ error?: string }>;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\nexport const AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n  const [user, setUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Check for existing session\n    const initializeAuth = async () => {\n      try {\n        const currentUser = await authService.getCurrentUser();\n        setUser(currentUser);\n      } catch (error) {\n        console.error('Auth initialization error:', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    initializeAuth();\n\n    // Listen for auth changes\n    const { data: { subscription } } = authService.onAuthStateChange((user) => {\n      setUser(user);\n      setLoading(false);\n    });\n\n    return () => {\n      subscription?.unsubscribe();\n    };\n  }, []);\n\n  const signIn = async (email: string, password: string) => {\n    setLoading(true);\n    try {\n      const result = await authService.signIn({ email, password });\n      if (result.user) {\n        setUser(result.user);\n        return {};\n      }\n      return { error: result.error || 'Sign in failed' };\n    } catch (error) {\n      return { error: 'An unexpected error occurred' };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signUp = async (data: {\n    email: string;\n    password: string;\n    username: string;\n    fullName: string;\n    languagePreference: 'en' | 'my';\n  }) => {\n    setLoading(true);\n    try {\n      const result = await authService.signUp(data);\n      if (result.user) {\n        setUser(result.user);\n        return {};\n      }\n      return { error: result.error || 'Sign up failed' };\n    } catch (error) {\n      return { error: 'An unexpected error occurred' };\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const signOut = async () => {\n    setLoading(true);\n    try {\n      await authService.signOut();\n      setUser(null);\n    } catch (error) {\n      console.error('Sign out error:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const updateProfile = async (updates: any) => {\n    if (!user) return { error: 'No user logged in' };\n    \n    try {\n      const result = await authService.updateProfile(user.id, updates);\n      if (!result.error) {\n        // Refresh user data\n        const updatedUser = await authService.getCurrentUser();\n        setUser(updatedUser);\n      }\n      return result;\n    } catch (error) {\n      return { error: 'Failed to update profile' };\n    }\n  };\n\n  const value: AuthContextType = {\n    user,\n    loading,\n    signIn,\n    signUp,\n    signOut,\n    updateProfile,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}