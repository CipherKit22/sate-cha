{"ast":null,"code":"import{supabase}from'../lib/supabase';class AuthService{async signUp(data){try{const{data:authData,error:authError}=await supabase.auth.signUp({email:data.email,password:data.password});if(authError){return{error:authError.message};}if(authData.user){// Create profile\nconst{error:profileError}=await supabase.from('profiles').insert({id:authData.user.id,username:data.username,full_name:data.fullName,language_preference:data.languagePreference});if(profileError){return{error:profileError.message};}return{user:{id:authData.user.id,email:authData.user.email}};}return{error:'Failed to create user'};}catch(error){return{error:'An unexpected error occurred'};}}async signIn(data){try{const{data:authData,error}=await supabase.auth.signInWithPassword({email:data.email,password:data.password});if(error){return{error:error.message};}if(authData.user){const profile=await this.getProfile(authData.user.id);return{user:{id:authData.user.id,email:authData.user.email,profile:profile||undefined}};}return{error:'Failed to sign in'};}catch(error){return{error:'An unexpected error occurred'};}}async signOut(){try{const{error}=await supabase.auth.signOut();if(error){return{error:error.message};}return{};}catch(error){return{error:'An unexpected error occurred'};}}async getCurrentUser(){try{const{data:{user}}=await supabase.auth.getUser();if(user){const profile=await this.getProfile(user.id);return{id:user.id,email:user.email,profile:profile||undefined};}return null;}catch(error){return null;}}async getProfile(userId){try{const{data,error}=await supabase.from('profiles').select('*').eq('id',userId).single();if(error){return null;}return data;}catch(error){return null;}}async updateProfile(userId,updates){try{const{error}=await supabase.from('profiles').update({...updates,updated_at:new Date().toISOString()}).eq('id',userId);if(error){return{error:error.message};}return{};}catch(error){return{error:'An unexpected error occurred'};}}onAuthStateChange(callback){return supabase.auth.onAuthStateChange(async(event,session)=>{if(session!==null&&session!==void 0&&session.user){const profile=await this.getProfile(session.user.id);callback({id:session.user.id,email:session.user.email,profile:profile||undefined});}else{callback(null);}});}}export const authService=new AuthService();","map":{"version":3,"names":["supabase","AuthService","signUp","data","authData","error","authError","auth","email","password","message","user","profileError","from","insert","id","username","full_name","fullName","language_preference","languagePreference","signIn","signInWithPassword","profile","getProfile","undefined","signOut","getCurrentUser","getUser","userId","select","eq","single","updateProfile","updates","update","updated_at","Date","toISOString","onAuthStateChange","callback","event","session","authService"],"sources":["C:/Users/Acer/Downloads/test1/frontend/src/services/auth.ts"],"sourcesContent":["import { supabase, Profile, User } from '../lib/supabase';\nimport { AuthError, User as SupabaseUser } from '@supabase/supabase-js';\n\nexport interface AuthResponse {\n  user?: User;\n  error?: string;\n}\n\nexport interface SignUpData {\n  email: string;\n  password: string;\n  username: string;\n  fullName: string;\n  languagePreference: 'en' | 'my';\n}\n\nexport interface SignInData {\n  email: string;\n  password: string;\n}\n\nclass AuthService {\n  async signUp(data: SignUpData): Promise<AuthResponse> {\n    try {\n      const { data: authData, error: authError } = await supabase.auth.signUp({\n        email: data.email,\n        password: data.password,\n      });\n\n      if (authError) {\n        return { error: authError.message };\n      }\n\n      if (authData.user) {\n        // Create profile\n        const { error: profileError } = await supabase\n          .from('profiles')\n          .insert({\n            id: authData.user.id,\n            username: data.username,\n            full_name: data.fullName,\n            language_preference: data.languagePreference,\n          });\n\n        if (profileError) {\n          return { error: profileError.message };\n        }\n\n        return { user: { id: authData.user.id, email: authData.user.email! } };\n      }\n\n      return { error: 'Failed to create user' };\n    } catch (error) {\n      return { error: 'An unexpected error occurred' };\n    }\n  }\n\n  async signIn(data: SignInData): Promise<AuthResponse> {\n    try {\n      const { data: authData, error } = await supabase.auth.signInWithPassword({\n        email: data.email,\n        password: data.password,\n      });\n\n      if (error) {\n        return { error: error.message };\n      }\n\n      if (authData.user) {\n        const profile = await this.getProfile(authData.user.id);\n        return {\n          user: {\n            id: authData.user.id,\n            email: authData.user.email!,\n            profile: profile || undefined,\n          },\n        };\n      }\n\n      return { error: 'Failed to sign in' };\n    } catch (error) {\n      return { error: 'An unexpected error occurred' };\n    }\n  }\n\n  async signOut(): Promise<{ error?: string }> {\n    try {\n      const { error } = await supabase.auth.signOut();\n      if (error) {\n        return { error: error.message };\n      }\n      return {};\n    } catch (error) {\n      return { error: 'An unexpected error occurred' };\n    }\n  }\n\n  async getCurrentUser(): Promise<User | null> {\n    try {\n      const { data: { user } } = await supabase.auth.getUser();\n      \n      if (user) {\n        const profile = await this.getProfile(user.id);\n        return {\n          id: user.id,\n          email: user.email!,\n          profile: profile || undefined,\n        };\n      }\n      \n      return null;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async getProfile(userId: string): Promise<Profile | null> {\n    try {\n      const { data, error } = await supabase\n        .from('profiles')\n        .select('*')\n        .eq('id', userId)\n        .single();\n\n      if (error) {\n        return null;\n      }\n\n      return data;\n    } catch (error) {\n      return null;\n    }\n  }\n\n  async updateProfile(userId: string, updates: Partial<Profile>): Promise<{ error?: string }> {\n    try {\n      const { error } = await supabase\n        .from('profiles')\n        .update({\n          ...updates,\n          updated_at: new Date().toISOString(),\n        })\n        .eq('id', userId);\n\n      if (error) {\n        return { error: error.message };\n      }\n\n      return {};\n    } catch (error) {\n      return { error: 'An unexpected error occurred' };\n    }\n  }\n\n  onAuthStateChange(callback: (user: User | null) => void) {\n    return supabase.auth.onAuthStateChange(async (event, session) => {\n      if (session?.user) {\n        const profile = await this.getProfile(session.user.id);\n        callback({\n          id: session.user.id,\n          email: session.user.email!,\n          profile: profile || undefined,\n        });\n      } else {\n        callback(null);\n      }\n    });\n  }\n}\n\nexport const authService = new AuthService();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}